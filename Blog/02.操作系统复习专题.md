## 1.è¿›ç¨‹-çº¿ç¨‹-åç¨‹
### 1-1.è¿›ç¨‹
- è¿›ç¨‹ï¼šæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„å®ä¾‹ï¼Œç³»ç»Ÿä¸­çš„æ¯ä¸ªç¨‹åºéƒ½è¿è¡Œåœ¨æŸä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼›è¿›ç¨‹æ˜¯ç³»ç»Ÿèµ„æºåˆ†é…çš„æœ€å°å•ä½
- è¿›ç¨‹å‡ºç°çš„ç›®çš„ï¼šæ›´å¥½çš„åˆ©ç”¨CPUèµ„æº
    - Aæ‰§è¡Œä»»åŠ¡ï¼ˆè¯»å–æ•°æ®ï¼‰çš„æ—¶å€™ï¼Œè®©Bæ‰§è¡Œä»»åŠ¡ï¼Œå½“Aè¯»å–å®Œæ•°æ®åï¼Œå†â€œåˆ‡æ¢â€å›Aä»»åŠ¡
    - åˆ‡æ¢æ¶‰åŠåˆ°çŠ¶æ€çš„ä¿å­˜å’Œæ¢å¤ï¼Œå› æ­¤é€šè¿‡è¿›ç¨‹æ¥åˆ†é…èµ„æºï¼Œæ ‡è¯†ä»»åŠ¡
    - åˆ†é…CPUå»æ‰§è¡Œè¿›ç¨‹ç§°ä¹‹ä¸ºè°ƒåº¦ï¼Œè¿›ç¨‹çš„çŠ¶æ€ä¿å­˜ã€æ¢å¤ã€ä¸Šä¸‹æ–‡åˆ‡æ¢
- è¿›ç¨‹å†…éƒ¨æœ‰å“ªäº›ä¿¡æ¯
    - è¿›ç¨‹æè¿°ä¿¡æ¯ï¼šè¿›ç¨‹æ ‡è¯†å·/ç”¨æˆ·æ ‡è¯†å·/å®¶æ—å…³ç³»
    - è¿›ç¨‹æ§åˆ¶ä¿¡æ¯ï¼šè¿›ç¨‹å½“å‰çŠ¶æ€/è¿›ç¨‹ä¼˜å…ˆçº§/ç¨‹åºå¼€å§‹åœ°å€/å„ç§è®¡æ—¶ä¿¡æ¯/é€šä¿¡ä¿¡æ¯/èµ„æºç®¡ç†ä¿¡æ¯ç­‰ç­‰
### 1-2.çº¿ç¨‹
- çº¿ç¨‹ï¼šè¿è¡Œåœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„é€»è¾‘æµï¼›çº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½
- çº¿ç¨‹å‡ºç°çš„ç›®çš„ï¼šå…±äº«è¿›ç¨‹èµ„æºï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æŸè€—
    - ABä»»åŠ¡æ‹¥æœ‰å…±åŒéœ€è¦çš„ç³»ç»Ÿèµ„æº
### 1-3.åç¨‹
- åç¨‹ï¼šç¨‹åºä¹‹é—´çš„åˆ‡æ¢ç”±ç”¨æˆ·è‡ªè¡Œå¤„ç†ï¼Œå¯ä»¥æ˜¯å¤§å‹ç¨‹åºä¸­çš„æŸæ®µä»£ç ï¼›åç¨‹æ˜¯ç”¨æˆ·çº§åˆ«çš„CPUè°ƒåº¦
- çº¿ç¨‹å‡ºç°çš„ç›®çš„ï¼šé¿å…é™·å…¥å†…æ ¸çº§åˆ«çš„ä¸Šä¸‹æ–‡åˆ‡æ¢é€ æˆæ€§èƒ½ä¸Šçš„æŸå¤±
    - é«˜å¹¶å‘åœºæ™¯ï¼Œå­˜åœ¨å¤§é‡çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€çš„æƒ…å†µ 
    - è¿›ç¨‹/çº¿ç¨‹éƒ½æ˜¯æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„ï¼›åç¨‹ç”±ç¨‹åºåŸç”Ÿæ”¯æŒ
    - æ ¸å¿ƒï¼šçº¿ç¨‹æ˜¯å†…æ ¸æ€è°ƒåº¦ï¼Œåç¨‹æ˜¯ç”¨æˆ·æ€è°ƒåº¦
### 1-4.ä¸Šä¸‹æ–‡åˆ‡æ¢
- å®šä¹‰ï¼šå°†CPUèµ„æºä»ä¸€ä¸ªè¿›ç¨‹åˆ†é…ç»™å¦ä¸€ä¸ªè¿›ç¨‹çš„æœºåˆ¶ï¼Œå› ä¸ºåŒä¸€æ—¶åˆ»åªèƒ½æ‰§è¡Œä¸€æ¡CPUæŒ‡ä»¤
- åˆ‡æ¢è¿‡ç¨‹ï¼šåœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼šé¦–å…ˆè¦å­˜å‚¨å½“å‰è¿›ç¨‹çŠ¶æ€ï¼Œè¯»å…¥ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„çŠ¶æ€ï¼Œç„¶åæ‰§è¡Œæ¬¡è¿›ç¨‹
- ä¸ºä»€ä¹ˆè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä»£ä»·é«˜ï¼Ÿ
    - è¿›ç¨‹åˆ‡æ¢åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šå¯¹äºçº¿ç¨‹æ¥è¯´åªéœ€è¦æ‰§è¡Œç¬¬2æ­¥ï¼Œå¯¹äºè¿›ç¨‹æ¥è¯´è¦æ‰§è¡Œ12æ­¥
        1. åˆ‡æ¢é¡µç›®å½•ä»¥ä½¿ç”¨æ–°çš„åœ°å€ç©ºé—´
        2. åˆ‡æ¢å†…æ ¸æ ˆå’Œç¡¬ä»¶ä¸Šä¸‹æ–‡

- å…¶ä»–å…³äºè¿›ç¨‹å’Œçº¿ç¨‹çš„æè¿°ï¼š
    - è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯CPUå·¥ä½œæ—¶é—´æ®µçš„æè¿°ï¼Œåªä¸è¿‡æ˜¯é¢—ç²’åº¦ä¸åŒï¼›å› ä¸ºçº¿ç¨‹å…±äº«è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥æ˜¯æ›´ç»†çš„CPUæ—¶é—´æ®µæè¿°
    - è¿›ç¨‹å°±æ˜¯åŒ…æ¢ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç¨‹åºæ‰§è¡Œæ—¶é—´æ€»å’Œ = CPUåŠ è½½ä¸Šä¸‹æ–‡+CPUæ‰§è¡Œ+CPUä¿å­˜ä¸Šä¸‹æ–‡

## 2.è¿›ç¨‹ç±»å‹
### 2-1.å®ˆæŠ¤è¿›ç¨‹
- å®ˆæŠ¤è¿›ç¨‹ï¼šè¿è¡Œåœ¨åå°çš„ä¸€ç§ç‰¹æ®Šè¿›ç¨‹ï¼Œç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯å¹¶å‘¨æœŸæ€§åœ°æ‰§è¡ŒæŸäº›ä»»åŠ¡
### 2-2.å­¤å„¿è¿›ç¨‹
- å­¤å„¿è¿›ç¨‹ï¼šä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œè¿™äº›å­è¿›ç¨‹ç§°ä¸ºå­¤å„¿è¿›ç¨‹
- å½“çˆ¶è¿›ç¨‹é€€å‡ºåï¼šå­¤å„¿è¿›ç¨‹å°†ç”± init è¿›ç¨‹æ”¶å…»å¹¶å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œ
### 2-3.åƒµå°¸è¿›ç¨‹
- åƒµå°¸è¿›ç¨‹ï¼šå­è¿›ç¨‹exit()é€€å‡ºåï¼Œçˆ¶è¿›ç¨‹æ²¡æœ‰å¯¹å…¶è¿›è¡Œå›æ”¶(è°ƒç”¨wait()æˆ–waitpid()å‡½æ•°)ï¼Œå¯¼è‡´å­è¿›ç¨‹å ç”¨çš„èµ„æºæ²¡æœ‰é‡Šæ”¾ä»è€Œæˆä¸ºåƒµå°¸è¿›ç¨‹
- è§£å†³åŠæ³•ï¼š
    1. ä½¿ç”¨topå‘½ä»¤çš„æ—¶å€™æŸ¥çœ‹zombieä¿¡æ¯
    2. ps -elf | grep Z æ‰¾åˆ°å¯¹åº”çš„åƒµå°¸è¿›ç¨‹
    3. kill -9 P_pid æ€æ­»åƒµå°¸è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼›è®©å­è¿›ç¨‹ç”±Initè¿›ç¨‹å›æ”¶
- å¦‚ä½•é¿å…ï¼š
    - çˆ¶è¿›ç¨‹wait()æˆ–waitpid()ç­‰å¾…å­è¿›ç¨‹ç»“æŸ
    - Singalä¿¡å·ï¼šå½“å­è¿›ç¨‹exit()åï¼Œå‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨wait()
    - Singalä¿¡å·ï¼šå°†ä¿¡å·ç›´æ¥å‘å¾€å†…æ ¸ï¼Œç”±å†…æ ¸ç›´æ¥å›æ”¶
    - fork()ä¸¤æ¬¡ï¼šå­è¿›ç¨‹exit()åï¼Œå­™è¿›ç¨‹ç”±Initè¿›ç¨‹å›æ”¶

## 3.è¿›ç¨‹/çº¿ç¨‹é€šä¿¡æ–¹å¼
### 3-1.è¿›ç¨‹é—´é€šä¿¡
- è¿›ç¨‹é€šä¿¡æ–¹å¼ï¼šç®¡é“/æ¶ˆæ¯é˜Ÿåˆ—/ä¿¡å·é‡/å…±äº«å­˜å‚¨/Socket
    - **ä¿¡å·é‡**ï¼šæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶å¤šä¸ªè¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œäº¤æ¢çš„ä¿¡æ¯é‡è¾ƒå°‘ä¹Ÿç§°ä¹‹ä¸ºä½çº§è¿›ç¨‹é€šä¿¡
    - **ç®¡é“**ï¼šå•å‘ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œæ— æ ¼å¼çš„ï¼Œå›ºå®šå¤§å°çš„å­—èŠ‚æµï¼Œå®ƒæŠŠä¸€ä¸ªè¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºå’Œå¦ä¸€ä¸ªè¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¿æ¥åœ¨ä¸€èµ·ï¼ˆåœºæ™¯ï¼šçˆ¶å­è¿›ç¨‹ä¸­ï¼‰
    - **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šæ˜¯ä¸€ä¸ªåœ¨ç³»ç»Ÿå†…æ ¸ä¸­ç”¨æ¥ä¿å­˜æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œå®ƒåœ¨ç³»ç»Ÿå†…æ ¸ä¸­æ˜¯ä»¥æ¶ˆæ¯é“¾è¡¨çš„å½¢å¼å‡ºç°çš„ï¼›æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·ä¼ é€’ä¿¡æ¯å°‘ã€ç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­—èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼ºç‚¹
    - **å…±äº«å­˜å‚¨**ï¼šå…è®¸å¤šä¸ªè¿›ç¨‹è®¿é—®åŒä¸€ä¸ªé€»è¾‘å†…å­˜ï¼Œè¿™ä¸ªé€»è¾‘å†…å­˜å¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹æ˜ å°„åˆ°è‡ªèº«çš„å†…å­˜åœ°å€ç©ºé—´ä¸­ï¼Œæ˜¯æœ€å¿«çš„IPCé€šä¿¡æ–¹å¼ï¼›ä¸“é—¨é’ˆå¯¹å…¶ä»–åº•å±‚è¿›ç¨‹é€šä¿¡æ–¹å¼æ¥è®¾è®¡çš„ï¼Œé€šå¸¸é…åˆä¿¡å·é‡å®Œæˆè¿›ç¨‹çš„é€šä¿¡å’ŒåŒæ­¥
    - **å¥—æ¥å­—**ï¼šå¯ç”¨äºä¸åŒä¸»æœºä¸Šè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡
### 3-2.çº¿ç¨‹é—´é€šä¿¡
- çº¿ç¨‹é€šä¿¡æ–¹å¼ï¼šåŒä¸€è¿›ç¨‹ä¸‹çš„çº¿ç¨‹å…±äº«æ•°æ®ï¼ˆæ¯”å¦‚å…¨å±€å˜é‡ï¼Œé™æ€å˜é‡ï¼‰ï¼Œé€šè¿‡è¿™äº›æ•°æ®æ¥é€šä¿¡ä¸ä»…å¿«æ·è€Œä¸”æ–¹ä¾¿ï¼Œæ‰€ä»¥ä¸»è¦ä½œç”¨æ˜¯çº¿ç¨‹åŒæ­¥é—®é¢˜
    - ğŸ”’æœºåˆ¶ï¼šäº’æ–¥é”/æ¡ä»¶å˜é‡/è¯»å†™é”
    - ä¿¡å·æœºåˆ¶
    - ä¿¡å·é‡æœºåˆ¶
## 4.è¿›ç¨‹è°ƒåº¦
### 4-1.è°ƒåº¦ç§ç±»
- ä½œä¸šè°ƒåº¦ï¼šå†³å®šæŠŠåèƒŒä½œä¸šè°ƒå…¥å†…å­˜ä¸­è¿è¡Œ
- è¿›ç¨‹è°ƒåº¦ï¼šå†³å®šæŠŠå°±ç»ªé˜Ÿåˆ—çš„æŸä¸ªè¿›ç¨‹è·å¾—CPU 
- è™šæ‹Ÿå­˜å‚¨ä¸­å¼•å…¥è°ƒåº¦ï¼šåœ¨å†…å¤–å¯¹æ¢åŒºè¿›è¡Œè¿›ç¨‹å¯¹æ¢
### 4-2.è°ƒåº¦æ–¹å¼
- éæŠ¢å è°ƒåº¦ï¼šä¸€æ—¦åˆ†é…CPUç»™è¿›ç¨‹ä¾¿è®©å…¶ä¸€ç›´è¿è¡Œï¼Œç›´åˆ°è¿›ç¨‹å®Œæˆæˆ–å‘ç”Ÿè¿›ç¨‹è°ƒåº¦æŸä¸ªäº‹ä»¶è€Œå µå¡æ—¶ï¼Œæ‰ä¼šæŠŠCPUåˆ†é…ç»™å…¶ä»–è¿›ç¨‹
- æŠ¢å è°ƒåº¦ï¼šæ“ä½œç³»ç»Ÿå°†æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æš‚åœï¼Œç”±è°ƒåº¦ç¨‹åºå°†CPUåˆ†é…ç»™å…¶ä»–å°±ç»ªè¿›ç¨‹çš„è°ƒåº¦æ–¹å¼
### 4-3.è°ƒåº¦ç®—æ³•
- FIFOï¼šå…ˆæ¥å…ˆè°ƒåº¦
- SJPï¼šæœ€çŸ­çš„ä½œä¸š(CPUåŒºé—´é•¿åº¦æœ€å°)æœ€å…ˆè°ƒåº¦
- SRJPï¼šSJPçš„æŠ¢å ç‰ˆæœ¬
- ä¼˜å…ˆæƒè°ƒåº¦ï¼šä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡æœ€å…ˆè°ƒåº¦
- è½®è¯¢è°ƒåº¦
- å¤šçº§é˜Ÿåˆ—è°ƒåº¦
- **å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦**ï¼š
    1. è¿›ç¨‹åœ¨è¿›å…¥å¾…è°ƒåº¦çš„é˜Ÿåˆ—ç­‰å¾…æ—¶ï¼Œé¦–å…ˆè¿›å…¥ä¼˜å…ˆçº§æœ€é«˜çš„Q1ç­‰å¾…
    2. é¦–å…ˆè°ƒåº¦ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ã€‚è‹¥é«˜ä¼˜å…ˆçº§ä¸­é˜Ÿåˆ—ä¸­å·²æ²¡æœ‰è°ƒåº¦çš„è¿›ç¨‹ï¼Œåˆ™è°ƒåº¦æ¬¡ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ã€‚
    3. å¯¹äºåŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„å„ä¸ªè¿›ç¨‹ï¼ŒæŒ‰ç…§æ—¶é—´ç‰‡è½®è½¬æ³•è°ƒåº¦
    4. åœ¨ä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹åœ¨è¿è¡Œæ—¶ï¼Œåˆæœ‰æ–°åˆ°è¾¾çš„ä½œä¸šï¼Œé‚£ä¹ˆåœ¨è¿è¡Œå®Œè¿™ä¸ªæ—¶é—´ç‰‡åï¼ŒCPUé©¬ä¸Šåˆ†é…ç»™æ–°åˆ°è¾¾çš„ä½œä¸š(æŠ¢å å¼)

## 5.çº¿ç¨‹å…±äº«èµ„æºå’Œç‹¬å èµ„æºåˆ†é…é—®é¢˜
- å †ï¼šæ˜¯å¤§å®¶å…±æœ‰çš„ç©ºé—´ï¼Œåˆ†å…¨å±€å †å’Œå±€éƒ¨å †
    - å…¨å±€å †å°±æ˜¯æ‰€æœ‰æ²¡æœ‰åˆ†é…çš„ç©ºé—´
    - å±€éƒ¨å †å°±æ˜¯ç”¨æˆ·åˆ†é…çš„ç©ºé—´
- æ ˆï¼šæ˜¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„ï¼Œä¿å­˜å…¶è¿è¡ŒçŠ¶æ€å’Œå±€éƒ¨è‡ªåŠ¨å˜é‡çš„
    - æ ˆåœ¨çº¿ç¨‹å¼€å§‹çš„æ—¶å€™åˆå§‹åŒ–ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆäº’ç›¸ç‹¬ç«‹ï¼Œå› æ­¤æ ˆæ˜¯thread safeçš„
    - æ“ä½œç³»ç»Ÿåœ¨åˆ‡æ¢çº¿ç¨‹çš„æ—¶å€™ä¼šè‡ªåŠ¨çš„åˆ‡æ¢æ ˆï¼Œå°±æ˜¯åˆ‡æ¢SS/ESPå¯„å­˜å™¨

## 6.Linuxç½‘ç»œIOæ¨¡å‹
### 6-1.åŒæ­¥/å¼‚æ­¥/é˜»å¡/éé˜»å¡
- åŒæ­¥ï¼šæ‰§è¡Œä¸€ä¸ªæ“ä½œåï¼Œç­‰å¾…ç»“æœï¼Œç„¶åæ‰æ‰§è¡Œåç»­æ“ä½œ
- å¼‚æ­¥ï¼šæ‰§è¡Œä¸€ä¸ªæ“ä½œåï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œç­‰å¾…é€šçŸ¥å†æ¥æ‰§è¡Œåˆšæ‰æ²¡æ‰§è¡Œå®Œçš„æ“ä½œ
- é˜»å¡ï¼šè¿›ç¨‹ç»™CPUä¼ è¾¾ä»»åŠ¡åï¼Œä¸€ç›´ç­‰å¾…CPUå¤„ç†å®Œåï¼Œç„¶åæ‰§è¡Œåç»­æ“ä½œ
- éé˜»å¡ï¼šè¿›ç¨‹ç»™CPUä¼ è¾¾ä»»åŠ¡åï¼Œç»§ç»­æ‰§è¡Œåç»­æ“ä½œï¼Œéš”æ–­æ—¶é—´å†æ¥è¯¢é—®ä¹‹å‰çš„æ“ä½œæ˜¯å¦å®Œæˆ
### 6-2.select/poll/epoll
- **select**ï¼šå…·æœ‰O(N)çš„æ— å·®åˆ«è½®è¯¢å¤æ‚åº¦ï¼Œä½¿ç”¨å…ƒç»„è¿›è¡Œå­˜å‚¨fd
- **poll**ï¼šè·Ÿselectç±»ä¼¼ï¼Œä½†ä½¿ç”¨é“¾è¡¨å­˜å‚¨è¿™æ ·å°±æ²¡æœ‰æœ€å¤§è¿æ¥æ•°çš„é™åˆ¶
- **epoll**ï¼šäº‹ä»¶é©±åŠ¨ï¼ˆæ¯ä¸ªäº‹ä»¶å…³è”fdï¼‰ï¼Œä¼šæŠŠæ¯ä¸ªIOæµçš„äº‹ä»¶ä¿¡æ¯é€šçŸ¥æˆ‘ä»¬ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)
- epollçš„ä¸¤ç§æ¨¡å¼ï¼š
    - **LTæ¨¡å¼**ï¼šåªè¦fdä¸­è¿˜æœ‰æ•°æ®å¯è¯»ï¼Œæ¯æ¬¡epoll_wait()éƒ½ä¼šè¿”å›å®ƒçš„äº‹ä»¶ä¿¡æ¯ï¼Œé€šçŸ¥ç”¨æˆ·ç¨‹åºå»æ“ä½œ
    - **ETæ¨¡å¼**ï¼šå®ƒåªä¼šæç¤ºä¸€æ¬¡ï¼Œç›´åˆ°ä¸‹æ¬¡å†æœ‰æ•°æ®æµå…¥ä¹‹å‰éƒ½ä¸ä¼šå†æç¤ºäº†ï¼Œæ— è®ºfdä¸­æ˜¯å¦è¿˜æœ‰æ•°æ®å¯è¯»ï¼Œæ‰€ä»¥è¿™ä¸ªæ¨¡å¼ä¸‹ä¸€å®šè¦è¯»å®Œbuffer
    - ä¸ºä»€ä¹ˆè¦æœ‰ETæ¨¡å¼ï¼šåœ¨LTæ¨¡å¼ä¸‹ï¼Œå¦‚æœæœ‰å¤§é‡ä¸éœ€è¦è¯»å†™çš„å°±ç»ªfdï¼Œæ¯æ¬¡è°ƒç”¨epoll_waitéƒ½ä¼šè¿”å›ï¼Œè¿™æ ·å½±å“ç”¨æˆ·ç¨‹åºæ£€ç´¢è‡ªå·±æ‰€å…³å¿ƒçš„fdçš„æ•ˆç‡; è¿™ç§æ¨¡å¼æ•ˆç‡æ›´é«˜ï¼Œç³»ç»Ÿä¸­ä¸ä¼šå……æ–¥ç€å¤§é‡ä¸éœ€è¦çš„å°±ç»ªfd
- epollä¼˜ç‚¹ï¼š
    - æ²¡æœ‰æœ€å¤§è¿æ¥æ•°é™åˆ¶
    - æ•ˆç‡æå‡ï¼šä¸æ˜¯è½®è¯¢æ–¹å¼ï¼Œè€Œæ˜¯â€œæ´»è·ƒå¯ç”¨â€çš„fdè¿›è¡Œcallback
- æ€»ç»“ï¼š
    - selectå’Œpollåœ¨â€œé†’ç€â€çŠ¶æ€æ—¶éœ€è¦ä¸æ–­è½®è¯¢fdé›†åˆï¼Œè€Œepollåªéœ€è¦åˆ¤æ–­â€œå°±ç»ªé“¾è¡¨â€æ˜¯å¦ä¸ºç©ºå€¼ï¼Œå› ä¸ºå°±ç»ªè®¾å¤‡ä¼šè¿›è¡Œ**callback**ï¼Œå°†å°±ç»ªfdæ”¾å…¥åˆ°å°±ç»ªé“¾è¡¨ä¸­ï¼Œæ‰€ä»¥èŠ‚çœå¤§é‡CPUæ—¶é—´
    - selectå’Œpollæ¯æ¬¡è½®è¯¢éƒ½éœ€è¦å°†fdé›†åˆä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œè€Œepollåªéœ€è¦æ‹·è´ä¸€æ¬¡ï¼Œè¿™æ ·èƒ½èŠ‚çœå¼€é”€

## 7.copy-on-writeæŠ€æœ¯ 
- COWæŠ€æœ¯ï¼šå¤šä¸ªè°ƒç”¨è€…è°ƒç”¨ç›¸åŒèµ„æºæ—¶ï¼Œå®ƒä»¬ä¼šè·å¾—ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘çš„èµ„æºï¼Œå½“æœ‰è°ƒç”¨è€…ä¿®æ”¹èµ„æºå†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½å‰¯æœ¬ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…çš„èµ„æºå†…å®¹ä¿æŒä¸å˜
- ä¼˜ç‚¹ï¼šå¦‚æœæ²¡æœ‰è°ƒç”¨è€…ä¿®æ”¹èµ„æºï¼Œå°±ä¸ä¼šæœ‰å‰¯æœ¬çš„åˆ›å»ºï¼ŒèŠ‚çœèµ„æºå’Œç³»ç»Ÿå¼€é”€
- COWè¯¦è¿°ï¼šç³»ç»Ÿä¼šä¸ºå­è¿›ç¨‹åˆ›å»ºè™šæ‹Ÿç©ºé—´ç»“æ„ï¼ˆæ¥è‡ªäºçˆ¶è¿›ç¨‹ï¼‰ï¼Œä½†æ˜¯ä¸ä¼šåˆ›å»ºç‰©ç†ç©ºé—´ï¼›è™šæ‹Ÿç©ºé—´æ˜¯æŒ‡å‘ç‰©ç†ç©ºé—´çš„



## 8.TCPæœ€å¤§è¿æ¥æ•°é—®é¢˜
- TCPæœ€å¤§è¿æ¥æ•°çš„å½±å“å› ç´ ï¼šå†…å­˜å’Œæ–‡ä»¶æè¿°ç¬¦
- æ–‡ä»¶æè¿°ç¬¦ï¼šæ¯ä¸ªtcpè¿æ¥éƒ½ä¼šå ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ“ä½œç³»ç»Ÿå¯¹æœ€å¤§æ–‡ä»¶æ•°æœ‰é™åˆ¶
- å¦‚ä½•ä¿®æ”¹TCPæœ€å¤§è¿æ¥æ•°ï¼šå•ä¸ªè¿›ç¨‹èƒ½å¤Ÿæ‰“å¼€çš„æ–‡ä»¶æ•°é‡é»˜è®¤ä¸Šé™ä¸º1024ï¼ˆå‘½ä»¤ï¼š`ulimit -n`ï¼‰
    1. ä¸´æ—¶ä¿®æ”¹ï¼šulimit -n [numbers]
    2. é‡å¯åå¤±æ•ˆï¼š
        ```
        # é…ç½®æ–‡ä»¶ï¼š/etc/security/limits.conf
        soft nofile 1000000
        hard nofile 1000000
        ```
    3. æ°¸ä¹…ä¿®æ”¹ï¼šåœ¨/etc/rc.localæ–‡ä»¶ä¸­: `ulimit -SHna 1000000`
    4. å…¨å±€é™åˆ¶ï¼šåœ¨/etc/sysctl.confæ–‡ä»¶ä¸­ï¼š
        ```
        [root@test ~]# cat /proc/sys/fs/file-nr 
        # å·²ç»åˆ†é…çš„æ–‡ä»¶å¥æŸ„æ•°      å·²ç»åˆ†é…ä½†æ²¡æœ‰ä½¿ç”¨çš„å¥æŸ„æ•°   æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°
        992	 0	95146
        # è°ƒæ•´ç›¸å…³å€¼ï¼š/etc/sysctl.confæ–‡ä»¶ä¸­
        fs.file-max = 1000000    # æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°
        net.ipv4.ip_conntrack_max = 1000000
        net.ipv4.netfilter.ip_conntrack_max = 1000000
        ```
- é«˜å¹¶å‘WebæœåŠ¡å†…æ ¸å‚æ•°è°ƒä¼˜ï¼š
    ```shell
    net.ipv4.tcp_syncookies=1   # é¢„é˜²å°‘é‡SYNæ”»å‡»
    net.ipv4.tcp_tw_reuse=1     # å¼€å¯é‡ç”¨(timewait)
    net.ipv4.tcp_tw_recycle=1   # å¼€å¯tcpå¿«é€Ÿå›æ”¶(timewait)
    net.ipv4.tcp_fin_timeout=30 # å¤„äºfin_wait_2çŠ¶æ€çš„æ—¶é—´
    net.ipv4.tcp_max_syn_backlog=65536  # åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦
    net.core.somaxconn=32768    # å…¨è¿æ¥é˜Ÿåˆ—é•¿åº¦
    net.core.netdev_max_backlog=65536   # æ¯ä¸ªç½‘ç»œæ¥å£èƒ½å¤Ÿæ¥æ”¶çš„æ•°é‡
    sysctl -w net.ipv4.ip_conntrack_max=65536
    ```
## 9.backlogå‚æ•°
- backlogæ˜¯ç³»ç»Ÿè°ƒç”¨listen()å‚æ•°ï¼Œlistenåªæ˜¯posixæ ‡å‡†ï¼Œä¸æ˜¯TCPçš„æ ‡å‡†ï¼Œå°±æ„å‘³ç€ä¸åŒçš„å†…æ ¸å¯ä»¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å®ç°
- Unixä¸­å®šä¹‰ï¼šbacklogå‚æ•°åªé™åˆ¶å…¨è¿æ¥é˜Ÿåˆ—é•¿åº¦
    - å…¨è¿æ¥é˜Ÿåˆ—-SYNé˜Ÿåˆ—ï¼šè¿›å…¥**ESTABLISHED**çŠ¶æ€
    - åŠè¿æ¥é˜Ÿåˆ—-ACCEPTé˜Ÿåˆ—ï¼šè¿›å…¥**SYN_RECV**çŠ¶æ€
- å…³äºsomaxconnå’Œmax_backlogåˆ†æï¼š 
    - å½“ä»SYN_RECVçŠ¶æ€å˜åŒ–ä¸ºEASTABLISHEDçŠ¶æ€åï¼Œå®ƒä¼šä»SYNé˜Ÿåˆ—è½¬ç§»ACCEPTé˜Ÿåˆ—ä¸­
    - backlogå‚æ•°æè¿°çš„æ˜¯æœåŠ¡å™¨ç«¯ESTABELLISHEDçŠ¶æ€å¯¹åº”çš„å…¨è¿æ¥é˜Ÿåˆ—é•¿åº¦
        - å…¨è¿æ¥é˜Ÿåˆ—é•¿åº¦ = min(`backlog`, å†…æ ¸å‚æ•°:`net.core.somaxconn`)
    - åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦ç”±å†…æ ¸å‚æ•° tcp_max_syn_backlogå†³å®š
        - åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦ = min(`backlog`, å†…æ ¸å‚æ•°:`net.core.somaxconn`ï¼Œå†…æ ¸å‚æ•°:`tcp_max_syn_backlog`)
    - æ€»ç»“ï¼šä»¥ä¸Šå…³äºå…¨/åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦å–å€¼æ„å‘³ç€ï¼šå½“å…¨è¿æ¥é˜Ÿåˆ—æ»¡åï¼Œå°±ä¸åœ¨æ¥å—è¿æ¥æ”¾å…¥åˆ°åŠè¿æ¥é˜Ÿåˆ—ä¸­
- å…³äºè®¾ç½®backlogå‚æ•°åï¼Œèƒ½å¤Ÿå»ºç«‹å…¨è¿æ¥çš„æ•°é‡ï¼š`backlog + 1 `é—®é¢˜
    - æºç ä¸­: å…³äºåˆ¤æ–­æ˜¯å¦åŠ å…¥å…¨è¿æ¥é˜Ÿåˆ—çš„æ¡ä»¶æ˜¯ï¼š`if å…¨è¿æ¥æ•° > backlog: è¿›é˜Ÿåˆ— ` 

## å‚è€ƒ
- æ“ä½œç³»ç»Ÿï¼š[https://www.cnblogs.com/inception6-lxc/p/9073983.html](https://www.cnblogs.com/inception6-lxc/p/9073983.html)
- Linuxç½‘ç»œIOæ¨¡å‹ï¼š[https://www.cnblogs.com/aspirant/p/9166944.html](https://www.cnblogs.com/aspirant/p/9166944.html)
- COWæŠ€æœ¯ï¼š[https://blog.csdn.net/weixin_39554266/article/details/82835478](https://blog.csdn.net/weixin_39554266/article/details/82835478)
- backlogå‚æ•°ï¼š[https://segmentfault.com/a/1190000019252960](https://segmentfault.com/a/1190000019252960)









